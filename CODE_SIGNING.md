# Подписание кода для Windows

## Проблема "Неизвестный издатель"

Windows показывает предупреждение "Неизвестный издатель" для неподписанных приложений. Чтобы убрать это предупреждение, нужно подписать приложение цифровым сертификатом.

## Решения

### Вариант 1: Купить сертификат (рекомендуется для коммерческих приложений)

1. **Купите Code Signing сертификат** у одного из провайдеров:
   - Sectigo (Comodo) - ~$200-400/год
   - DigiCert - ~$400-600/год
   - GlobalSign - ~$300-500/год

2. **Получите сертификат** в формате `.pfx` или `.p12`

3. **Настройте подписание** в package.json:

```json
"win": {
  "certificateFile": "path/to/certificate.pfx",
  "certificatePassword": "your_password",
  "publisherName": "Radj",
  "signingHashAlgorithms": ["sha256"],
  "sign": "./sign.js"
}
```

4. **Создайте sign.js** для подписания:

```javascript
exports.default = async function(configuration) {
  require("child_process").execSync(
    `signtool.exe sign /f "${configuration.path}" /p "${configuration.password}" /tr http://timestamp.digicert.com /td sha256 /fd sha256 "${configuration.path}"`
  );
};
```

### Вариант 2: Самоподписанный сертификат (для тестирования)

**Внимание:** Самоподписанные сертификаты НЕ убирают предупреждение Windows!

```bash
# Создайте самоподписанный сертификат
makecert -r -pe -n "CN=Radj" -ss My -sr CurrentUser -sky signature -eku 1.3.6.1.5.5.7.3.3 certificate.cer

# Экспортируйте в PFX
pvk2pfx -pvk certificate.pvk -spc certificate.cer -pfx certificate.pfx
```

### Вариант 3: Без подписи (текущее решение)

Мы добавили `"verifyUpdateCodeSignature": false` в package.json, чтобы автообновления работали без подписи.

**Пользователи увидят предупреждение при установке**, но смогут установить приложение, нажав "Дополнительно" → "Выполнить в любом случае".

## Настройки NSIS

Добавлены следующие настройки для улучшения установки:

- `createDesktopShortcut: true` - создание ярлыка на рабочем столе
- `createStartMenuShortcut: true` - создание ярлыка в меню Пуск
- `allowToChangeInstallationDirectory: true` - выбор папки установки
- `oneClick: false` - показывать мастер установки (не тихая установка)

## Рекомендации

1. **Для личного использования**: используйте portable версию
2. **Для небольшого распространения**: portable/ZIP версия
3. **Для широкого распространения**: Code Signing сертификат или Microsoft Store
4. **Для open-source**: portable версия + инструкция для пользователей

## Альтернатива 1: Portable версия (БЕЗ предупреждений!)

**Рекомендуется для распространения без подписи!**

Portable версия - это обычная папка с .exe файлом, которую можно запускать без установки.

### Преимущества:
- ✅ НЕТ предупреждений Windows при первом запуске
- ✅ Не требует прав администратора
- ✅ Можно запускать с флешки
- ✅ Не оставляет следов в системе

### Как собрать:

```bash
# Portable .exe (один файл)
npm run dist:win-portable

# ZIP архив (распаковать и запустить)
npm run dist:win-zip
```

### Как распространять:

1. Соберите portable версию
2. Загрузите на GitHub Releases или файлообменник
3. Пользователи скачивают, распаковывают и запускают .exe
4. При первом запуске Windows может показать предупреждение, но оно менее строгое

### Инструкция для пользователей:

```
1. Скачайте TS6-Overlay-portable.exe или TS6-Overlay-win.zip
2. Если Windows показывает предупреждение:
   - Нажмите "Подробнее"
   - Нажмите "Выполнить в любом случае"
3. Запустите приложение
4. При первом запуске разрешите подключение к TeamSpeak 6
```

## Альтернатива 2: Microsoft Store

Публикация в Microsoft Store автоматически подписывает приложение:
- Нет предупреждений Windows
- Автоматические обновления
- Стоимость: $19 единоразово для регистрации разработчика

## Сравнение вариантов

| Вариант | Предупреждение | Стоимость | Сложность |
|---------|---------------|-----------|----------|
| NSIS установщик | ⚠️ Да | Бесплатно | Низкая |
| Portable/ZIP | ⚠️ Минимальное | Бесплатно | Низкая |
| Code Signing | ✅ Нет | $200-400/год | Средняя |
| Microsoft Store | ✅ Нет | $19 один раз | Высокая |
