# TeamSpeak OverLive - Архитектура

## Структура проекта

### Парсеры (`public/js/parsers/`)
Низкоуровневые парсеры протоколов TeamSpeak:

- **ts3-parser.js** - Парсинг сообщений TS3 ClientQuery протокола
- **ts6-parser.js** - Парсинг JSON сообщений TS6 Remote App API

### Сервисы (`public/js/services/`)
Бизнес-логика приложения:

- **user-list-service.js** - Универсальная логика сортировки, фильтрации и управления списком пользователей

### Клиенты (`public/js/`)
Клиенты для подключения к TeamSpeak:

- **ts3-client.js** - Клиент для TeamSpeak 3 (использует TS3Parser)
- **ts6-client.js** - Клиент для TeamSpeak 6 (использует TS6Parser)

### UI и управление (`public/js/`)
- **ui.js** - Рендеринг интерфейса (использует UserListService)
- **app.js** - Главный контроллер приложения
- **settings.js** - Управление настройками
- **window-manager.js** - Управление окном
- **updater.js** - Автообновления

## Принципы архитектуры

### 1. Разделение ответственности
- **Парсеры** - только парсинг данных, без бизнес-логики
- **Сервисы** - универсальная бизнес-логика, независимая от источника данных
- **Клиенты** - управление подключением и использование парсеров
- **UI** - только отображение, использует сервисы для обработки данных

### 2. Унификация
- Оба клиента (TS3/TS6) возвращают одинаковую структуру данных
- Единый сервис для сортировки и управления списком пользователей
- Единый UI для отображения пользователей из любого источника

### 3. Исправленные баги
- TS3: Корректное обновление списка при смене канала
- TS3: Владелец оверлея всегда отображается корректно
- Визуальное разделение владельца от остальных пользователей

### 4. Улучшения UX
- Плавные переходы (0.4s cubic-bezier) при активации клиентов
- Визуальное масштабирование говорящих пользователей (scale 1.02)
- Разделитель между владельцем и остальными пользователями
- Улучшенная анимация индикатора говорения

## Структура данных

### Клиент (Client)
```javascript
{
    id: number,           // ID клиента
    name: string,         // Имя пользователя
    isSpeaking: boolean,  // Говорит ли сейчас
    isMe: boolean         // Это владелец оверлея
}
```

### Состояние клиента TeamSpeak
```javascript
{
    clients: Client[],              // Список пользователей
    currentChannelId: number,       // ID текущего канала
    myClientId: number,             // ID владельца
    isConnected: boolean,           // Подключен к TS
    isConnectedToServer: boolean    // Подключен к серверу
}
```

## Порядок загрузки скриптов

1. Парсеры (ts3-parser.js, ts6-parser.js)
2. Сервисы (user-list-service.js)
3. Клиенты (ts6-client.js, ts3-client.js)
4. UI и управление (window-manager.js, settings.js, ui.js, updater.js)
5. Главное приложение (app.js)
